#!/bin/bash

TEMP=validation_result.txt
FILE="index.html"
CSS_FILE="style.min.css"
JS_FILE="script.min.js"

if ! grep -q "$CSS_FILE" "$FILE" || ! grep -q "$JS_FILE" "$FILE"; then
  echo 'minified files not in use'
  exit 1
fi

W3C_HTML="https://validator.w3.org/nu/?out=gnu"
curl -s -H "Content-Type: text/html" -H "charset=utf-8" -X POST --data-binary "@${FILE}" "${W3C_HTML}" >"${TEMP}"
if grep -q "error" "${TEMP}"; then
  echo "HTML validation failed, check ${TEMP} for details"
  exit 1
else
  rm "${TEMP}"
fi

W3C_CSS="https://jigsaw.w3.org/css-validator/validator"
curl -s -F "file=@$CSS_FILE;type=text/css" -F "output=text/plain" "$W3C_CSS" -o "${TEMP}"
if ! grep -q "Congratulations! No Error Found." "${TEMP}"; then
  echo "CSS validation failed, check ${TEMP} for details"
  exit 1
else
  rm "${TEMP}"
fi

if ! node -c "$JS_FILE"; then
  echo 'invalid JS'
  exit 1
fi
