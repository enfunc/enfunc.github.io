#!/bin/bash

if [ $# -lt 1 ]; then
  echo "Usage: $0 [file1] [file2] ..."
  exit 1
fi

DIR=$(dirname "$0")

for file in "$@"; do
  extension="${file##*.}"
  filename="${file%.*}"

  if [ "$extension" == "css" ]; then
    min=$(curl -X POST -s --data-urlencode "input@${file}" https://www.toptal.com/developers/cssminifier/api/raw)
    echo "$min" >"${DIR}/${filename}.min.css"
  elif [ "$extension" == "js" ]; then
    curl -s \
      -d "output_format=text" \
      -d "compilation_level=ADVANCED_OPTIMIZATIONS" \
      -d "output_info=compiled_code" \
      --data-urlencode "js_code@${file}" \
      https://closure-compiler.appspot.com/compile \
      -o "${DIR}/${filename}.min.js"
  else
    echo "Unsupported file type: $file"
  fi
done
